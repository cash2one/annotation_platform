#!/usr/bin/env python
# -*- coding: utf-8 -*-
__author__ = 'defaultstr'

from mongoengine import *
from user_system.models import User

try:
    import simplejson as json
except ImportError:
    import json


class Task(Document):
    """
    class for a annotation task
    """
    task_name = StringField()             #
    task_description = StringField()      #
    annotation_per_unit = IntField()      #
    credit_per_annotation = IntField()    #
    task_tag = StringField()              # task tag is used for determining corresponding TaskManager
    display = BooleanField(default=True)


class TaskUnit(Document):
    """
    class for each annotation unit, could be a SERP, a query-url pair, etc.
    """
    tag = StringField(required=True)  # use tag to identify each task unit, should be unique
    unit_content = StringField()      # the content of the task unit, usually a JSON-serialized string
    task = ReferenceField(Task)       # reference to the task


class Annotation(Document):
    """
    class for each annotation made by user
    """
    task_unit = ReferenceField(TaskUnit)  # the corresponding TaskUnit
    user = ReferenceField(User)           # the user that make this annotation
    annotation_content = StringField()    # the annotation data, usually a JSON-serialized string
    task = ReferenceField(Task)           # reference to the task
    credit = IntField()                   # credits per annotation


class Log(Document):
    user = ReferenceField(User)
    task = ReferenceField(Task)
    action = StringField()
    action_object = StringField()         # action on which html('html1' or 'html2')
    task_unit = ReferenceField(TaskUnit)
    content = StringField()               # Timestamp, Action, Info


class ExtensionLog(Document):
    user = ReferenceField(User)
    task = ReferenceField(Task)
    task_unit = ReferenceField(TaskUnit)
    action = StringField()
    action_object = StringField()
    content = StringField()


